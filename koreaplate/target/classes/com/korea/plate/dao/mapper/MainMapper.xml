<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.korea.plate.dao.MainDAO">
	
	<!-- 지역리스트 -->
	<select id="main_list" resultType="com.korea.plate.dto.MainDTO">
		SELECT SUBSTR(DADDRESS, 1, INSTR(DADDRESS, ' ', 1, 1) -1) AS DONG, COUNT(*) AS COUNT
		FROM DEPARTMENT_INFO
		WHERE DACCEPT = 1
		GROUP BY SUBSTR(DADDRESS, 1, INSTR(DADDRESS, ' ', 1, 1) -1)
	</select>
	
	<select id="location_list" 	resultType="com.korea.plate.dto.DepartmentINFODTO">
		select * from department_info 
		where daddress like '%' || #{location} ||'%' and DACCPET=1 order by dRating desc	
	</select>
	
	<select id="get_locationCount" resultType="com.korea.plate.dto.MainDTO">
		select substr(daddress,1,INSTR(DADDRESS,' ',1,1)-1) as dong,count(*) as count
		from department_info 
		where daddress like '%' || #{location} ||'%' and DACCPET=1
		group by substr(daddress,1,INSTR(DADDRESS,' ',1,1)-1)
	</select>
	
	<select id="search_list" resultType="com.korea.plate.dto.DepartmentINFODTO">
		select *
		from department_info
		where DNAME like '%' || #{query} || '%' or daddress like '%' || #{query} ||'%' and DACCPET=1
	</select>

</mapper>